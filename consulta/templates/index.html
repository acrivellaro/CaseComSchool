<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Dashboard Empresa X</title>

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">

    <!-- Chart.Js -->
    <script src=
    "https://cdn.jsdelivr.net/npm/chart.js@4.0.1/dist/chart.umd.min.js">
        </script>


</head>

<body>
    <div class="container-fluid" style="margin-top: 50px;">

        <div class="row">
            <div class="col-1"></div>
            <div class="col-10">
                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab"
                            data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home"
                            aria-selected="true">Resumo Empresa</button>

                        <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile"
                            type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Indicador
                            Empresa</button>

                        <button class="nav-link" id="nav-linha-produto-tab" data-bs-toggle="tab"
                            data-bs-target="#nav-linha-produto" type="button" role="tab"
                            aria-controls="nav-linha-produto" aria-selected="false">
                            Resumo Produto</button>

                        <button class="nav-link" id="nav-indicador-produto-tab" data-bs-toggle="tab"
                            data-bs-target="#nav-indicador-produto" type="button" role="tab"
                            aria-controls="nav-indicador-produto" aria-selected="false">
                            Indicador Produto</button>
                    </div>
                </nav>

                <div class="tab-content" id="nav-tabContent">

                    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">

                        <div class="row" style="margin-top: 30px;">
                            <div class="col-auto">
                                <select class="form-select" id="periodo" onchange="dashboard_period();">
                                    <option value="2022-01">2022 - Janeiro</option>
                                    <option value="2022-02">2022 - Fevereiro</option>
                                    <option value="2022-03">2022 - Março</option>
                                    <option value="2022-04">2022 - Abril</option>
                                    <option value="2022-05">2022 - Maio</option>
                                    <option value="2022-06">2022 - Junho</option>
                                    <option value="2022-07">2022 - Julho</option>
                                    <option value="2022-08">2022 - Agosto</option>
                                    <option value="2022-09">2022 - Setembro</option>
                                    <option value="2022-10">2022 - Outubro</option>
                                    <option value="2022-11">2022 - Novembro</option>
                                    <option value="2022-12">2022 - Dezembro</option>
                                    <option value="2022-XX">2022 ** TOTAL **</option>
                                </select>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 50px;">

                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Faturamento</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="faturamento"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Margem Bruta</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="margem_bruta"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Ticket Medio</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="ticket_medio"></h5>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 50px;">
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Numero Transações</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="numero_transacoes"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Número Clientes</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="numero_clientes"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Frequencia Compra</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="frequencia_compra"></h5>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 50px;">
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Faturamento Funcionario</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="faturamento_funcionario"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Faturamento M2</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="faturamento_m2"></h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">

                        <div class="row" style="margin-top: 30px;">
                            <div class="col-auto">
                                <select class="form-select" id="indicador2" onchange="dashboard_indicador();">
                                    <option value="faturamento">Faturamento</option>
                                    <option value="margem_bruta">Margem Bruta</option>
                                    <option value="despesas">Despesas</option>
                                </select>
                            </div>

                            <div class="col-auto">
                                <select class="form-select" id="periodo2" onchange="dashboard_indicador();">
                                    <option value="2022-XX">2022</option>
                                </select>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 30px;">
                            <div class="col-10">
                                <canvas id="chart-indicador"></canvas>
                            </div>
                        </div>

                    </div>

                    <div class="tab-pane fade" id="nav-linha-produto" role="tabpanel"
                        aria-labelledby="nav-linha-produto-tab">

                        <div class="row" style="margin-top: 30px;">
                            <div class="col-auto">
                                <select class="form-select" id="periodo-linha-produto"
                                    onchange="dashboard_linha_produto();">
                                    <option value="2022-01">2022 - Janeiro</option>
                                    <option value="2022-02">2022 - Fevereiro</option>
                                    <option value="2022-03">2022 - Março</option>
                                    <option value="2022-04">2022 - Abril</option>
                                    <option value="2022-05">2022 - Maio</option>
                                    <option value="2022-06">2022 - Junho</option>
                                    <option value="2022-07">2022 - Julho</option>
                                    <option value="2022-08">2022 - Agosto</option>
                                    <option value="2022-09">2022 - Setembro</option>
                                    <option value="2022-10">2022 - Outubro</option>
                                    <option value="2022-11">2022 - Novembro</option>
                                    <option value="2022-12">2022 - Dezembro</option>
                                    <option value="2022-XX">2022 ** TOTAL **</option>
                                </select>
                            </div>

                            <div class="col-auto">
                                <select class="form-select" id="linha-produto" onchange="dashboard_linha_produto();">
                                    <option value="1">Sabonete</option>
                                    <option value="2">Shampoo</option>
                                    <option value="3">Lenço Umedecido</option>
                                    <option value="4">Creme Dental</option>
                                </select>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 50px;">

                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Faturamento</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="faturamento-linha"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Margem Bruta</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="margem-linha"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Share Faturamento</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="share-linha"></h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="nav-indicador-produto" role="tabpanel"
                        aria-labelledby="nav-linha-produto-tab">

                        <div class="row" style="margin-top: 30px;">
                            <div class="col-auto">
                                <select class="form-select" id="periodo3" onchange="dashboard_indicador_produto();">
                                    <option value="2022-XX">2022</option>
                                </select>
                            </div>

                            <div class="col-auto">
                                <select class="form-select" id="indicador3" onchange="dashboard_indicador_produto();">
                                    <option value="faturamento_linha">Faturamento</option>
                                    <option value="margem_linha">Margem Bruta</option>
                                    <option value="share_linha">Share</option>
                                </select>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 30px;">
                            <div class="col-10">
                                <canvas id="chart-indicador-2"></canvas>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>
</body>



<script>

    function dashboard_period() {

        var periodo = $('#periodo option:selected').val();

        $.ajax({
            type: "GET",
            dataType: "json",
            url: 'http://127.0.0.1:8000/dashboard_periodo',
            data: {
                "periodo": periodo
            }
        }).done(function (data, textStatus, jqXHR) {

            $('#faturamento').text(data.faturamento);
            $('#margem_bruta').text(data.margem_bruta);
            $('#ticket_medio').text(data.ticket_medio);
            $('#numero_transacoes').text(data.numero_transacoes);
            $('#numero_clientes').text(data.numero_clientes);
            $('#frequencia_compra').text(data.frequencia_compra);
            $('#faturamento_funcionario').text(data.faturamento_funcionario);
            $('#faturamento_m2').text(data.faturamento_m2);
        })
    }

    //  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --

    function dashboard_indicador() {

        var indicador = $('#indicador2 option:selected').val();
        var periodo = $('#periodo2 option:selected').val();

        $.ajax({
            type: "GET",
            dataType: "json",
            url: 'http://127.0.0.1:8000/dashboard_indicador',
            data: {
                "periodo": periodo,
                "indicador": indicador
            }
        }).done(function (data, textStatus, jqXHR) {
            setup_chart();
            draw_chart(data);
        })
    }

    //  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --

    var chart;
    var is_refresh = false;

    function setup_chart() {
        if (is_refresh) {
            chart.destroy();
        }
    }

    function draw_chart(dados) {

        var options = {
            responsive: true,
            plugins: {
                legend: {
                    display: false,
                    position: "right",
                },
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }],
            },
        };

        var ctx_chart = $("#chart-indicador");
        chart = new Chart(ctx_chart, { type: "bar", data: dados, options: options });

        is_refresh = true;
    }

    //  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --

    function dashboard_linha_produto() {

        var periodo = $('#periodo-linha-produto option:selected').val();
        var linha_produto = $('#linha-produto option:selected').val();

        $.ajax({
            type: "GET",
            dataType: "json",
            url: 'http://127.0.0.1:8000/dashboard_linha_produto',
            data: {
                "periodo": periodo,
                "linha_produto": linha_produto
            }
        }).done(function (data, textStatus, jqXHR) {

            $('#faturamento-linha').text(data.faturamento_linha);
            $('#share-linha').text(data.share_linha);
            $('#margem-linha').text(data.margem_linha);
        })
    }

    //  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --

    function dashboard_indicador_produto() {

        var indicador = $('#indicador3 option:selected').val();
        var periodo = $('#periodo3 option:selected').val();

        $.ajax({
            type: "GET",
            dataType: "json",
            url: 'http://127.0.0.1:8000/dashboard_indicador_produto',
            data: {
                "periodo": periodo,
                "indicador": indicador
            }
        }).done(function (data, textStatus, jqXHR) {
            setup_chart_2();
            draw_chart_2(data);
        })
    }

    //  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --

    var chart_2;
    var is_refresh_2 = false;

    function setup_chart_2() {
        if (is_refresh_2) {
            chart_2.destroy();
        }
    }

    //  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --

    function draw_chart_2(dados) {

        var options = {
            responsive: true,
            plugins: {
                legend: {
                    display: true,
                    position: "right",
                },
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }],

                x: {
                    stacked: true,
                },
                y: {
                    stacked: true
                }
            },
        };

        var ctx_chart_2 = $("#chart-indicador-2");
        chart_2 = new Chart(ctx_chart_2, { type: "bar", data: dados, options: options });

        is_refresh_2 = true;
    }

    //  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --  --

</script>

</body>

</html>