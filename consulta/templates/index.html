<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Dashboard Empresa X</title>

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">

    <!-- Chart.Js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.9.0/feather.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>

</head>

<body>
    <div class="container-fluid" style="margin-top: 50px;">

        <div class="row">
            <div class="col-1"></div>
            <div class="col-10">
                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab"
                            data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home"
                            aria-selected="true">Resumo Empresa</button>

                        <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile"
                            type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Indicador
                            Empresa</button>

                        <button class="nav-link" id="nav-linha-produto-tab" data-bs-toggle="tab"
                            data-bs-target="#nav-linha-produto" type="button" role="tab"
                            aria-controls="nav-linha-produto" aria-selected="false">Linha de
                            Produto</button>
                    </div>
                </nav>

                <div class="tab-content" id="nav-tabContent">

                    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">

                        <div class="row" style="margin-top: 30px;">
                            <div class="col-auto">
                                <select class="form-select" id="periodo" onchange="dashboard_period();">
                                    <option value="2022-01">2022 - Janeiro</option>
                                    <option value="2022-02">2022 - Fevereiro</option>
                                    <option value="2022-03">2022 - Março</option>
                                    <option value="2022-04">2022 - Abril</option>
                                    <option value="2022-05">2022 - Maio</option>
                                    <option value="2022-06">2022 - Junho</option>
                                    <option value="2022-07">2022 - Julho</option>
                                    <option value="2022-08">2022 - Agosto</option>
                                    <option value="2022-09">2022 - Setembro</option>
                                    <option value="2022-10">2022 - Outubro</option>
                                    <option value="2022-11">2022 - Novembro</option>
                                    <option value="2022-12">2022 - Dezembro</option>
                                    <option value="2022-XX">2022 ** TOTAL **</option>
                                </select>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 50px;">

                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Faturamento</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="faturamento"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Margem Bruta</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="margem_bruta"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Ticket Medio</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="ticket_medio"></h5>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 50px;">
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Numero Transações</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="numero_transacoes"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Número Clientes</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="numero_clientes"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Frequencia Compra</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="frequencia_compra"></h5>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 50px;">
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Faturamento Funcionario</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="faturamento_funcionario"></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="card">
                                    <div class="card-header">Faturamento M2</div>
                                    <div class="card-body">
                                        <h5 class="card-title" id="faturamento_m2"></h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">

                        <div class="row" style="margin-top: 30px;">
                            <div class="col-auto">
                                <select class="form-select" id="indicador2" onchange="dashboard_indicador();">
                                    <option value="faturamento">Faturamento</option>
                                    <option value="margem_bruta">Margem Bruta</option>
                                    <option value="despesas">Despesas</option>
                                </select>
                            </div>
                            <div class="col-auto">
                                <select class="form-select" id="periodo2" onchange="dashboard_indicador();">
                                    <option value="2022-XX">2022</option>
                                </select>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 30px;">
                            <div class="col-10">
                                <canvas id="chart-indicador"></canvas>
                            </div>
                        </div>

                    </div>

                </div>


            </div>
        </div>



    </div>
</body>



<script>

    function dashboard_period() {

        var periodo = $('#periodo option:selected').val();

        $.ajax({
            type: "GET",
            dataType: "json",
            url: 'http://127.0.0.1:8000/dashboard_periodo',
            data: {
                "periodo": periodo
            }
        }).done(function (data, textStatus, jqXHR) {

            $('#faturamento').text(data.faturamento);
            $('#margem_bruta').text(data.margem_bruta);
            $('#ticket_medio').text(data.ticket_medio);
            $('#numero_transacoes').text(data.numero_transacoes);
            $('#numero_clientes').text(data.numero_clientes);
            $('#frequencia_compra').text(data.frequencia_compra);
            $('#faturamento_funcionario').text(data.faturamento_funcionario);
            $('#faturamento_m2').text(data.faturamento_m2);
        })
    }


    function dashboard_indicador() {

        var indicador = $('#indicador2 option:selected').val();
        var periodo = $('#periodo2 option:selected').val();

        $.ajax({
            type: "GET",
            dataType: "json",
            url: 'http://127.0.0.1:8000/dashboard_indicador',
            data: {
                "periodo": periodo,
                "indicador": indicador
            }
        }).done(function (data, textStatus, jqXHR) {
            setup_chart();
            draw_chart(data);
        })
    }

    var chart;
    var is_refresh = false;

    function setup_chart() {
        if (is_refresh) {
            chart.destroy();
        }
    }

    function draw_chart(dados) {

        var options = {
            responsive: true,
            legend: {
                display: false,
                position: "right",
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }],
            },
        };

        var ctx_chart = $("#chart-indicador");
        chart = new Chart(ctx_chart, { type: "bar", data: dados, options: options });

        is_refresh = true;
    }


</script>

</body>

</html>